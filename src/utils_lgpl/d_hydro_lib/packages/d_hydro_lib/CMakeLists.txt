# Define library
set(library_name d_hydro_lib)
# Set directory which contains all source files
set(src_path src)

# Note that the CMAKE_CURRENT_SOURCE_DIR has a path to THIS CMakeLists location
set(d_hydro_lib_include_path ${CMAKE_CURRENT_SOURCE_DIR}/../../include)

if (UNIX)
    #name mangling, these functions are generated by the FortranCInterface cmake package and might be system dependent
    include(FortranCInterface)
    FortranCInterface_HEADER("${CMAKE_CURRENT_SOURCE_DIR}/include/FortranCInterface.h" MACRO_NAMESPACE "FC_")
    #produce a config.h to be included
    configure_file(${CMAKE_CURRENT_SOURCE_DIR}/config.h.cmake.in ${CMAKE_CURRENT_SOURCE_DIR}/include/config.h)  
    set(configFile "${CMAKE_CURRENT_SOURCE_DIR}/include/config.h") 
    
    include_directories(${NETCDF_INCLUDEDIR}) 
    add_definitions(-DHAVE_CONFIG_H=1)
endif(UNIX)

# Set public include path to make it accessible for other components
set(public_include_path ${d_hydro_lib_include_path})
set(d_hydro_include ${CMAKE_CURRENT_SOURCE_DIR}/include)


# Set include directories
include_directories(${d_hydro_lib_include_path}
                    ${d_hydro_include}
                    ${pthreads_path}
                    ${expat_include_path})

# Gather source files
file(GLOB header_files ${d_hydro_lib_include_path}/*.h)
file(GLOB source_files ${src_path}/*.cpp)


add_library(${library_name} ${header_files}
                            ${source_files})


# Set preprocessor definitions
if(WIN32)
    target_compile_definitions(${library_name} PRIVATE "WIN32")
endif(WIN32)
if(UNIX)
    target_compile_definitions(${library_name} PRIVATE "HAVE_CONFIG_H")
endif(UNIX)
# Define how the files should be structured within Visual Studio
source_group(TREE ${CMAKE_CURRENT_SOURCE_DIR} FILES ${source_files})
source_group(Include FILES  ${header_files})
set_target_properties (${library_name} PROPERTIES FOLDER utils_lgpl/d_hydro_lib)
